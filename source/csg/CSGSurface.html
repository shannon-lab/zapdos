<!DOCTYPE html><head><meta charset="UTF-8"><title>CSGSurface | Zapdos</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/zapdos.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Zapdos</a><a href="https://github.com/shannon-lab/zapdos" class="right"><img src="../../media/framework/github-logo.png" alt="GitHub wordmark" class="github-mark"></img><img src="../../media/framework/github-mark.png" alt="GitHub logo" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="4e7a3811-f32b-424e-a32e-598ff1c45ce2" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="80f6fc61-4892-4772-bb7b-3c7173994fde" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="584ecd13-f8c4-4cfd-a138-c8d1f522accc" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#" class="sidenav-trigger" data-target="4453c9cb-0a30-45b5-b3c0-0d0ac9006471"><i class="material-icons">menu</i></a><ul class="sidenav" id="4453c9cb-0a30-45b5-b3c0-0d0ac9006471"><li><a href="#!" class="dropdown-trigger" data-target="d9a90894-53b9-40ab-bcd3-282e7a6332b1" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="d1460ee0-5179-4618-a5b1-f0544b3597cd" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="3861404c-8ba8-4e75-b6fa-2d5b1d6eb11d" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="4e7a3811-f32b-424e-a32e-598ff1c45ce2"><li><a href="../../getting_started/installation.html">Installation</a></li><li><a href="../../getting_started/using_zapdos.html">Using Zapdos</a></li><li><a href="../../getting_started/zapdos_meshing.html">Generating Meshes</a></li><li><a href="../../tutorial/index.html">Tutorial Slides</a></li></ul><ul class="dropdown-content" id="80f6fc61-4892-4772-bb7b-3c7173994fde"><li><a href="../../syntax/zapdos_only.html">Zapdos Input Syntax</a></li><li><a href="../../syntax/index.html">Complete Code Syntax</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/libmesh/classes.html">libMesh Doxygen</a></li><li><a href="../../a-to-z.html">Zapdos A to Z Index</a></li><li><a href="../../examples/crane_examples.html">CRANE Examples</a></li><li><a href="../../development/contributing.html">Contributing Guidelines</a></li><li><a href="../../development/code_standards.html">Code Standards</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="584ecd13-f8c4-4cfd-a138-c8d1f522accc"><li><a href="https://github.com/shannon-lab/zapdos/discussions">Zapdos Discussions Forum</a></li><li><a href="../../development/zapdos_developer_info.html">Zapdos Developer Information</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussions Forum</a></li><li><a href="https://mooseframework.inl.gov/">MOOSE Homepage</a></li><li><a href="../../development/moose_developer_info.html">MOOSE Developer Information</a></li></ul><ul class="dropdown-content" id="d9a90894-53b9-40ab-bcd3-282e7a6332b1"><li><a href="../../getting_started/installation.html">Installation</a></li><li><a href="../../getting_started/using_zapdos.html">Using Zapdos</a></li><li><a href="../../getting_started/zapdos_meshing.html">Generating Meshes</a></li><li><a href="../../tutorial/index.html">Tutorial Slides</a></li></ul><ul class="dropdown-content" id="d1460ee0-5179-4618-a5b1-f0544b3597cd"><li><a href="../../syntax/zapdos_only.html">Zapdos Input Syntax</a></li><li><a href="../../syntax/index.html">Complete Code Syntax</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/libmesh/classes.html">libMesh Doxygen</a></li><li><a href="../../a-to-z.html">Zapdos A to Z Index</a></li><li><a href="../../examples/crane_examples.html">CRANE Examples</a></li><li><a href="../../development/contributing.html">Contributing Guidelines</a></li><li><a href="../../development/code_standards.html">Code Standards</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="3861404c-8ba8-4e75-b6fa-2d5b1d6eb11d"><li><a href="https://github.com/shannon-lab/zapdos/discussions">Zapdos Discussions Forum</a></li><li><a href="../../development/zapdos_developer_info.html">Zapdos Developer Information</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussions Forum</a></li><li><a href="https://mooseframework.inl.gov/">MOOSE Homepage</a></li><li><a href="../../development/moose_developer_info.html">MOOSE Developer Information</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">source</a><span class="breadcrumb">csg</span><a href="#" class="breadcrumb">CSGSurface</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="d0a3f975-71dd-4bca-99db-9731a5951d57" data-section-level="1" data-section-text="CSGSurface"><h1 id="csgsurface">CSGSurface</h1><p>This is an abstract class for any surface definition for <a href="../../syntax/CSG/index.html">constructive solid geometry (CSG)</a> representations. The <a href="CSGBase.html">CSGBase</a> framework already contains definitions for some basic surfaces (planes, spheres, and cylinders), but developers of modules or MOOSE-based application can define additional custom surfaces by deriving from this abstract <code>CSGBase</code> class. General information about implementing <span class="tooltipped" data-tooltip="Constructive Solid Geometry" data-position="top" data-delay="50">CSG</span>-related methods can be found in <a href="CSGBase.html">CSGBase</a>.</p><section class="scrollspy" id="27826cf9-e1cf-48f6-aa79-524b56e3bae2" data-section-level="2" data-section-text="Defining a New Surface Type"><h2 id="defining-a-new-surface-type">Defining a New Surface Type</h2><p>Any arbitrary or custom surface can be defined by inheriting from <code>CSGSurface</code>. At a minimum, the surface name and surface type, must be set, and two virtual methods that need to be defined. Additional information required by the constructor will depend on the specific surface to be defined.</p><section id="480052be-441f-4bdc-aad4-86bfb4d64cb4" data-section-level="3" data-section-text="Setting Coefficients"><h3 id="setting-coefficients">Setting Coefficients</h3><p>Each surface should be defined by some equation, which therefore requires the definition of coefficients or other parameters. These coefficient values should be set and be returned through the <code>getCoefficients</code> method which will return a map of the coefficient strings to their values. These coefficient values are returned in the <span class="tooltipped" data-tooltip="JavaScript Object Notation" data-position="top" data-delay="50">JSON</span> file that is produced. For example, a plane is defined by the equation <span class="moose-katex-inline-equation" id="moose-equation-c4ea2b1e-a2d0-484e-87ee-450aed590189"><script>var element = document.getElementById("moose-equation-c4ea2b1e-a2d0-484e-87ee-450aed590189");katex.render("ax + by + cz = d", element, {displayMode:false,throwOnError:false});</script></span> and so this method would return a map of the values for <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code>.</p></section><section id="7cf5cdcb-7ffa-4c19-abd0-714239850339" data-section-level="3" data-section-text="Half - space Determination"><h3 id="half-space-determination">Half-space Determination</h3><p>In <span class="tooltipped" data-tooltip="Constructive Solid Geometry" data-position="top" data-delay="50">CSG</span> representation, knowing which half-space of the surface is positive or negative is necessary for correct construction of a <a href="CSGBase.html#cells">cell</a> <a href="CSGBase.html#regions">region</a>. To help determine the sign of these half-spaces, each surface type should have a <code>evaluateSurfaceEquationAtPoint</code> method implemented that returns a floating point value, where a positive value indicates that the point lies in the positive half-space, a negative value indicates that the point lies in the negative half-space, and a value of 0 indicates that the point lies on the surface.</p></section><section id="f8ed7d0d-3de4-43de-a1ee-de52df9008b4" data-section-level="3" data-section-text="Setting the Surface Type"><h3 id="setting-the-surface-type">Setting the Surface Type</h3><p>The type of surface must be set for <code>_surface_type</code> in the surface constructor. It is recommended that this be done based on the class name using <code>MooseUtils::prettyCppType&lt;SurfaceClassName&gt;()</code> so that the surface type automatically matches the class that created it.</p></section><section id="78f177ea-b4bd-4d15-8186-4d65b736997a" data-section-level="3" data-section-text="Creating a Surface Clone"><h3 id="creating-a-surface-clone">Creating a Surface Clone</h3><p>In order to make sure that clones of CSGBase objects are created properly, each derived <code>CSGSurface</code> type must implement a <code>clone()</code> method, which returns a <code>std::unique_ptr&lt;CSGSurface&gt;</code> from the given surface instance. This can typically be done by calling <code>std::make_unique</code> on the constructor for the derived surface type.</p></section></section><section class="scrollspy" id="5ae005ba-adc2-4d92-bda8-1dc9cad0aedc" data-section-level="2" data-section-text="Example"><h2 id="example">Example</h2><p>Below shows how <code>CSGSphere</code> is implemented as an example.</p><pre style="max-height:350px;"><code class="language-cpp">
#pragma once

#include &quot;CSGSurface.h&quot;

#include &quot;libmesh/point.h&quot;

namespace CSG
{

/**
 * CSGSphere creates an internal representation of a Constructive Solid Geometry (CSG)
 * sphere, represented in the form (x - x0)^2 + (y - y0)^2 + (z - z0)^2 = r^2
 */
class CSGSphere : public CSGSurface
{
public:
  /**
   * @brief Construct a new CSGSphere surface
   *
   * @param name unique name for the sphere surface
   * @param center center point of sphere
   * @param r radius of sphere
   */
  CSGSphere(const std::string &amp; name, const Point &amp; center, const Real r);

  /**
   * @brief Construct a new CSGSphere surface
   *
   * @param name unique name for the sphere surface
   * @param r radius of sphere
   */
  CSGSphere(const std::string &amp; name, const Real r);

  /**
   * Destructor
   */
  virtual ~CSGSphere() = default;

  /**
   * @brief Get the coefficients (x0, y0, z0, r) for the equation of a sphere
   * (x - x0)^2 + (y - y0)^2 + (z - z0)^2 = r^2
   *
   * @return map of coefficients (x0, y0, z0, and r) and their values
   */
  virtual std::unordered_map&lt;std::string, Real&gt; getCoeffs() const override;

  /**
   * @brief given a point, determine its evaluation based on the equation of the sphere
   *
   * @param p point
   * @return evaluation of point based on surface equation
   */
  virtual Real evaluateSurfaceEquationAtPoint(const Point &amp; p) const override;

protected:
  /**
   * @brief create clone of CSGSphere object
   *
   * @return std::unordered_map&lt;CSGSurface&gt; unique_ptr to cloned sphere
   */
  virtual std::unique_ptr&lt;CSGSurface&gt; clone() const override
  {
    return std::make_unique&lt;CSGSphere&gt;(_name, Point(_x0, _y0, _z0), _r);
  }

  // check that radius is positive
  void checkRadius() const;

  /// Value of x0 in equation of sphere
  Real _x0;

  /// Value of y0 in equation of sphere
  Real _y0;

  /// Value of z0 in equation of sphere
  Real _z0;

  /// Value of r in equation of sphere
  Real _r;
};
} // namespace CSG
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#52344013-a074-45c9-9912-30b2e38aa28f">(moose/framework/include/csg/CSGSphere.h)</a><pre style="max-height:350px;"><code class="language-cpp">
#include &quot;CSGSphere.h&quot;

namespace CSG
{

CSGSphere::CSGSphere(const std::string &amp; name, const Point &amp; center, const Real r)
  : CSGSurface(name, MooseUtils::prettyCppType&lt;CSGSphere&gt;()),
    _x0(center(0)),
    _y0(center(1)),
    _z0(center(2)),
    _r(r)
{
  checkRadius();
}

CSGSphere::CSGSphere(const std::string &amp; name, const Real r)
  : CSGSurface(name, MooseUtils::prettyCppType&lt;CSGSphere&gt;()), _x0(0.0), _y0(0.0), _z0(0.0), _r(r)
{
  checkRadius();
}

std::unordered_map&lt;std::string, Real&gt;
CSGSphere::getCoeffs() const
{
  std::unordered_map&lt;std::string, Real&gt; coeffs = {{&quot;x0&quot;, _x0}, {&quot;y0&quot;, _y0}, {&quot;z0&quot;, _z0}, {&quot;r&quot;, _r}};
  return coeffs;
}

Real
CSGSphere::evaluateSurfaceEquationAtPoint(const Point &amp; p) const
{
  // Compute distance from the sphere center to determine if inside (&lt; r^2)
  // or outside (&gt; r^2) the sphere
  const Real dist_sq =
      Utility::pow&lt;2&gt;((p(0) - _x0)) + Utility::pow&lt;2&gt;((p(1) - _y0)) + Utility::pow&lt;2&gt;((p(2) - _z0));

  return dist_sq - Utility::pow&lt;2&gt;(_r);
}

void
CSGSphere::checkRadius() const
{
  if (_r &lt;= 0.0)
    mooseError(&quot;Radius of sphere must be positive.&quot;);
}

} // namespace CSG
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#81b16758-b293-4ddd-82a2-b7f1b4187065">(moose/framework/src/csg/CSGSphere.C)</a></section></section><div class="moose-modal modal" id="52344013-a074-45c9-9912-30b2e38aa28f"><div class="modal-content"><h4>(moose/framework/include/csg/CSGSphere.h)</h4><pre style="max-height:350px;"><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#pragma once

#include &quot;CSGSurface.h&quot;

#include &quot;libmesh/point.h&quot;

namespace CSG
{

/**
 * CSGSphere creates an internal representation of a Constructive Solid Geometry (CSG)
 * sphere, represented in the form (x - x0)^2 + (y - y0)^2 + (z - z0)^2 = r^2
 */
class CSGSphere : public CSGSurface
{
public:
  /**
   * @brief Construct a new CSGSphere surface
   *
   * @param name unique name for the sphere surface
   * @param center center point of sphere
   * @param r radius of sphere
   */
  CSGSphere(const std::string &amp; name, const Point &amp; center, const Real r);

  /**
   * @brief Construct a new CSGSphere surface
   *
   * @param name unique name for the sphere surface
   * @param r radius of sphere
   */
  CSGSphere(const std::string &amp; name, const Real r);

  /**
   * Destructor
   */
  virtual ~CSGSphere() = default;

  /**
   * @brief Get the coefficients (x0, y0, z0, r) for the equation of a sphere
   * (x - x0)^2 + (y - y0)^2 + (z - z0)^2 = r^2
   *
   * @return map of coefficients (x0, y0, z0, and r) and their values
   */
  virtual std::unordered_map&lt;std::string, Real&gt; getCoeffs() const override;

  /**
   * @brief given a point, determine its evaluation based on the equation of the sphere
   *
   * @param p point
   * @return evaluation of point based on surface equation
   */
  virtual Real evaluateSurfaceEquationAtPoint(const Point &amp; p) const override;

protected:
  /**
   * @brief create clone of CSGSphere object
   *
   * @return std::unordered_map&lt;CSGSurface&gt; unique_ptr to cloned sphere
   */
  virtual std::unique_ptr&lt;CSGSurface&gt; clone() const override
  {
    return std::make_unique&lt;CSGSphere&gt;(_name, Point(_x0, _y0, _z0), _r);
  }

  // check that radius is positive
  void checkRadius() const;

  /// Value of x0 in equation of sphere
  Real _x0;

  /// Value of y0 in equation of sphere
  Real _y0;

  /// Value of z0 in equation of sphere
  Real _z0;

  /// Value of r in equation of sphere
  Real _r;
};
} // namespace CSG
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="81b16758-b293-4ddd-82a2-b7f1b4187065"><div class="modal-content"><h4>(moose/framework/src/csg/CSGSphere.C)</h4><pre style="max-height:350px;"><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#include &quot;CSGSphere.h&quot;

namespace CSG
{

CSGSphere::CSGSphere(const std::string &amp; name, const Point &amp; center, const Real r)
  : CSGSurface(name, MooseUtils::prettyCppType&lt;CSGSphere&gt;()),
    _x0(center(0)),
    _y0(center(1)),
    _z0(center(2)),
    _r(r)
{
  checkRadius();
}

CSGSphere::CSGSphere(const std::string &amp; name, const Real r)
  : CSGSurface(name, MooseUtils::prettyCppType&lt;CSGSphere&gt;()), _x0(0.0), _y0(0.0), _z0(0.0), _r(r)
{
  checkRadius();
}

std::unordered_map&lt;std::string, Real&gt;
CSGSphere::getCoeffs() const
{
  std::unordered_map&lt;std::string, Real&gt; coeffs = {{&quot;x0&quot;, _x0}, {&quot;y0&quot;, _y0}, {&quot;z0&quot;, _z0}, {&quot;r&quot;, _r}};
  return coeffs;
}

Real
CSGSphere::evaluateSurfaceEquationAtPoint(const Point &amp; p) const
{
  // Compute distance from the sphere center to determine if inside (&lt; r^2)
  // or outside (&gt; r^2) the sphere
  const Real dist_sq =
      Utility::pow&lt;2&gt;((p(0) - _x0)) + Utility::pow&lt;2&gt;((p(1) - _y0)) + Utility::pow&lt;2&gt;((p(2) - _z0));

  return dist_sq - Utility::pow&lt;2&gt;(_r);
}

void
CSGSphere::checkRadius() const
{
  if (_r &lt;= 0.0)
    mooseError(&quot;Radius of sphere must be positive.&quot;);
}

} // namespace CSG
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#27826cf9-e1cf-48f6-aa79-524b56e3bae2" class="tooltipped" data-position="left" data-tooltip="Defining a New Surface Type">Defining a New Surface Type</a></li><li><a href="#5ae005ba-adc2-4d92-bda8-1dc9cad0aedc" class="tooltipped" data-position="left" data-tooltip="Example">Example</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>